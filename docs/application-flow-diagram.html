<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Application Flow Diagram</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { width: 100%; height: 100%; overflow: auto; background: #f8fafc; }
  .container { width: 100vw; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 16px; }
  svg { width: 100%; height: auto; max-width: 100vw; }
</style>
</head>
<body>
<div class="container">
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 3000 3800" font-family="'Segoe UI', 'Helvetica Neue', Arial, sans-serif">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f8fafc"/>
      <stop offset="100%" style="stop-color:#e2e8f0"/>
    </linearGradient>
    <linearGradient id="startG" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#1d4ed8"/>
    </linearGradient>
    <linearGradient id="procG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#eff6ff"/>
      <stop offset="100%" style="stop-color:#dbeafe"/>
    </linearGradient>
    <linearGradient id="decG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fef9c3"/>
      <stop offset="100%" style="stop-color:#fde68a"/>
    </linearGradient>
    <linearGradient id="actG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#dcfce7"/>
      <stop offset="100%" style="stop-color:#bbf7d0"/>
    </linearGradient>
    <linearGradient id="errG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fee2e2"/>
      <stop offset="100%" style="stop-color:#fecaca"/>
    </linearGradient>
    <linearGradient id="apiG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ede9fe"/>
      <stop offset="100%" style="stop-color:#ddd6fe"/>
    </linearGradient>
    <linearGradient id="dataG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fce7f3"/>
      <stop offset="100%" style="stop-color:#fbcfe8"/>
    </linearGradient>
    <linearGradient id="featG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f0fdf4"/>
      <stop offset="100%" style="stop-color:#dcfce7"/>
    </linearGradient>
    <linearGradient id="extG2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e9d5ff"/>
      <stop offset="100%" style="stop-color:#d8b4fe"/>
    </linearGradient>
    <filter id="sh" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="0" dy="3" stdDeviation="4" flood-opacity="0.12"/>
    </filter>
    <filter id="shL" x="-2%" y="-2%" width="104%" height="106%">
      <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.08"/>
    </filter>
    <marker id="aD" viewBox="0 0 10 10" refX="5" refY="10" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 0 0 L 5 10 L 10 0" fill="#475569"/>
    </marker>
    <marker id="aR" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10" fill="#475569"/>
    </marker>
    <marker id="aL" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 10 0 L 0 5 L 10 10" fill="#475569"/>
    </marker>
    <marker id="aGr" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10" fill="#16a34a"/>
    </marker>
    <marker id="aGl" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 10 0 L 0 5 L 10 10" fill="#16a34a"/>
    </marker>
    <marker id="aRd" viewBox="0 0 10 10" refX="0" refY="5" markerWidth="10" markerHeight="10" orient="auto">
      <path d="M 10 0 L 0 5 L 10 10" fill="#dc2626"/>
    </marker>
  </defs>

  <rect width="3000" height="3800" fill="url(#bg)" rx="16"/>

  <!-- Title -->
  <text x="1500" y="65" text-anchor="middle" font-size="48" font-weight="700" fill="#1e293b">FinAware — Application Flow Diagram</text>
  <text x="1500" y="110" text-anchor="middle" font-size="22" fill="#64748b">Complete User Journey: Authentication → FICA Verification → Dashboard → Feature Modules</text>

  <!-- ═══════════ SECTION 1: AUTH ═══════════ -->
  <rect x="60" y="140" width="2880" height="880" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="180" font-size="28" font-weight="700" fill="#334155">1. AUTHENTICATION FLOW</text>

  <!-- Start -->
  <ellipse cx="1500" cy="240" rx="140" ry="40" fill="url(#startG)" filter="url(#sh)"/>
  <text x="1500" y="248" text-anchor="middle" font-size="22" font-weight="600" fill="#fff">User Arrives</text>

  <line x1="1500" y1="280" x2="1500" y2="330" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- Landing Page -->
  <rect x="1200" y="335" width="600" height="80" rx="12" fill="url(#procG)" stroke="#3b82f6" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="372" text-anchor="middle" font-size="22" font-weight="600" fill="#1e40af">Landing Page (/join or /login)</text>
  <text x="1500" y="400" text-anchor="middle" font-size="17" fill="#64748b">LandingForm component — Select document type</text>

  <line x1="1500" y1="415" x2="1500" y2="475" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- Document Type Decision -->
  <polygon points="1500,475 1720,545 1500,615 1280,545" fill="url(#decG)" stroke="#eab308" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="537" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Document</text>
  <text x="1500" y="562" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Type?</text>

  <!-- SA ID Branch -->
  <line x1="1280" y1="545" x2="820" y2="545" stroke="#475569" stroke-width="2.5" marker-end="url(#aL)"/>
  <text x="1050" y="530" text-anchor="middle" font-size="18" font-weight="500" fill="#475569">SA_ID</text>
  <rect x="480" y="510" width="340" height="70" rx="10" fill="url(#actG)" stroke="#22c55e" stroke-width="1.5" filter="url(#sh)"/>
  <text x="650" y="543" text-anchor="middle" font-size="19" font-weight="600" fill="#166534">SA ID Input</text>
  <text x="650" y="568" text-anchor="middle" font-size="15" fill="#6b7280">13 digits + Luhn checksum validation</text>

  <!-- Passport Branch -->
  <line x1="1720" y1="545" x2="2180" y2="545" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>
  <text x="1950" y="530" text-anchor="middle" font-size="18" font-weight="500" fill="#475569">PASSPORT</text>
  <rect x="2180" y="510" width="340" height="70" rx="10" fill="url(#actG)" stroke="#22c55e" stroke-width="1.5" filter="url(#sh)"/>
  <text x="2350" y="543" text-anchor="middle" font-size="19" font-weight="600" fill="#166534">Passport Input</text>
  <text x="2350" y="568" text-anchor="middle" font-size="15" fill="#6b7280">Country selector (11) + Number pattern</text>

  <!-- Converge -->
  <line x1="650" y1="580" x2="650" y2="640" stroke="#475569" stroke-width="2"/>
  <line x1="2350" y1="580" x2="2350" y2="640" stroke="#475569" stroke-width="2"/>
  <line x1="650" y1="640" x2="2350" y2="640" stroke="#475569" stroke-width="2"/>
  <line x1="1500" y1="640" x2="1500" y2="685" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- API Call -->
  <rect x="1100" y="690" width="800" height="80" rx="12" fill="url(#apiG)" stroke="#7c3aed" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="725" text-anchor="middle" font-size="22" font-weight="600" fill="#5b21b6">POST /api/microservices/auth/login</text>
  <text x="1500" y="755" text-anchor="middle" font-size="16" fill="#7c3aed">Auth Service → loginOrCreateUser() | Validates ID/Passport | Returns session</text>

  <line x1="1500" y1="770" x2="1500" y2="825" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- Intent Decision -->
  <polygon points="1500,825 1720,895 1500,965 1280,895" fill="url(#decG)" stroke="#eab308" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="887" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Auth</text>
  <text x="1500" y="912" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Intent?</text>

  <!-- Join -->
  <line x1="1280" y1="895" x2="780" y2="895" stroke="#16a34a" stroke-width="2.5" marker-end="url(#aGl)"/>
  <text x="1030" y="878" text-anchor="middle" font-size="18" font-weight="500" fill="#16a34a">join (new user)</text>
  <rect x="280" y="855" width="500" height="85" rx="10" fill="url(#actG)" stroke="#22c55e" stroke-width="1.5" filter="url(#sh)"/>
  <text x="530" y="888" text-anchor="middle" font-size="19" font-weight="600" fill="#166534">Generate Simulated Profile</text>
  <text x="530" y="912" text-anchor="middle" font-size="15" fill="#6b7280">Risk: ID suffix → Level | Create User + 2-6 Debts + CreditProfile</text>
  <text x="530" y="932" text-anchor="middle" font-size="15" fill="#6b7280">Seeded random for reproducible demo data</text>

  <!-- Login -->
  <line x1="1720" y1="895" x2="2220" y2="895" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>
  <text x="1970" y="878" text-anchor="middle" font-size="18" font-weight="500" fill="#475569">login (existing)</text>
  <rect x="2220" y="865" width="460" height="60" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#sh)"/>
  <text x="2450" y="895" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Find Existing User by ID</text>
  <text x="2450" y="917" text-anchor="middle" font-size="15" fill="#64748b">Return session if found, 404 if not</text>

  <!-- Converge -->
  <line x1="530" y1="940" x2="530" y2="985" stroke="#475569" stroke-width="2"/>
  <line x1="2450" y1="925" x2="2450" y2="985" stroke="#475569" stroke-width="2"/>
  <line x1="530" y1="985" x2="2450" y2="985" stroke="#475569" stroke-width="2"/>
  <line x1="1500" y1="985" x2="1500" y2="1020" stroke="#475569" stroke-width="2.5"/>

  <!-- ═══════════ SECTION 2: FICA ═══════════ -->
  <rect x="60" y="1030" width="2880" height="510" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="1070" font-size="28" font-weight="700" fill="#334155">2. FICA VERIFICATION &amp; SESSION SETUP</text>

  <!-- Set Cookies -->
  <rect x="1150" y="1095" width="700" height="75" rx="12" fill="url(#dataG)" stroke="#ec4899" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="1128" text-anchor="middle" font-size="22" font-weight="600" fill="#9d174d">Set Session Cookies (httpOnly)</text>
  <text x="1500" y="1155" text-anchor="middle" font-size="16" fill="#be185d">SESSION_COOKIE + FICA_VERIFIED_COOKIE + FICA_REQUIRED_COOKIE</text>

  <line x1="1500" y1="1170" x2="1500" y2="1220" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- FICA Decision -->
  <polygon points="1500,1220 1740,1295 1500,1370 1260,1295" fill="url(#decG)" stroke="#eab308" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="1287" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">FICA</text>
  <text x="1500" y="1312" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Verified?</text>

  <!-- No -->
  <line x1="1260" y1="1295" x2="780" y2="1295" stroke="#dc2626" stroke-width="2.5" marker-end="url(#aRd)"/>
  <text x="1020" y="1278" text-anchor="middle" font-size="18" font-weight="500" fill="#dc2626">No (new user)</text>
  <rect x="280" y="1260" width="500" height="75" rx="12" fill="url(#procG)" stroke="#3b82f6" stroke-width="2" filter="url(#sh)"/>
  <text x="530" y="1293" text-anchor="middle" font-size="21" font-weight="600" fill="#1e40af">/fica-verification Page</text>
  <text x="530" y="1322" text-anchor="middle" font-size="15" fill="#64748b">Upload: ID Document + Proof of Address + Bank Statement (optional)</text>

  <line x1="530" y1="1335" x2="530" y2="1395" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <rect x="260" y="1400" width="540" height="70" rx="12" fill="url(#apiG)" stroke="#7c3aed" stroke-width="2" filter="url(#sh)"/>
  <text x="530" y="1433" text-anchor="middle" font-size="20" font-weight="600" fill="#5b21b6">POST /api/microservices/auth/fica/verify</text>
  <text x="530" y="1458" text-anchor="middle" font-size="15" fill="#7c3aed">Set is_fica_verified = true, fica_verified_at = now()</text>

  <line x1="800" y1="1435" x2="1230" y2="1435" stroke="#16a34a" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#aGr)"/>

  <!-- Yes -->
  <line x1="1740" y1="1295" x2="2220" y2="1295" stroke="#16a34a" stroke-width="2.5" marker-end="url(#aGr)"/>
  <text x="1980" y="1278" text-anchor="middle" font-size="18" font-weight="500" fill="#16a34a">Yes (verified)</text>
  <rect x="2220" y="1262" width="460" height="65" rx="12" fill="url(#actG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <text x="2450" y="1293" text-anchor="middle" font-size="20" font-weight="600" fill="#166534">Middleware Passes</text>
  <text x="2450" y="1315" text-anchor="middle" font-size="15" fill="#6b7280">Route to protected pages allowed</text>

  <!-- Dashboard redirect -->
  <rect x="1230" y="1410" width="540" height="85" rx="14" fill="url(#startG)" filter="url(#sh)"/>
  <text x="1500" y="1448" text-anchor="middle" font-size="26" font-weight="700" fill="#fff">Redirect to /dashboard</text>
  <text x="1500" y="1478" text-anchor="middle" font-size="16" fill="#dbeafe">Main application entry point</text>

  <line x1="2450" y1="1327" x2="2450" y2="1452" stroke="#475569" stroke-width="2"/>
  <line x1="2450" y1="1452" x2="1770" y2="1452" stroke="#475569" stroke-width="2"/>

  <line x1="1500" y1="1495" x2="1500" y2="1555" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- ═══════════ SECTION 3: DASHBOARD ═══════════ -->
  <rect x="60" y="1560" width="2880" height="480" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="1600" font-size="28" font-weight="700" fill="#334155">3. DASHBOARD — Main Hub (Server-Side Rendered)</text>

  <rect x="1050" y="1625" width="900" height="75" rx="12" fill="url(#apiG)" stroke="#7c3aed" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="1658" text-anchor="middle" font-size="22" font-weight="600" fill="#5b21b6">GET /api/microservices/dashboard/overview/:userId</text>
  <text x="1500" y="1688" text-anchor="middle" font-size="16" fill="#7c3aed">Dashboard Service (Port 4102) — Server-side data fetching</text>

  <line x1="1500" y1="1700" x2="1500" y2="1745" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <rect x="600" y="1750" width="1800" height="85" rx="12" fill="url(#actG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <text x="1500" y="1782" text-anchor="middle" font-size="20" font-weight="600" fill="#166534">Dashboard Service Processing Pipeline</text>
  <text x="1500" y="1812" text-anchor="middle" font-size="16" fill="#6b7280">getUserById() → listDebtsForUser() → calculateDashboardMetrics() → getFinancialAgeDetails() → getRiskFactors() → buildScoreProjection() → debtComposition</text>

  <line x1="1500" y1="1835" x2="1500" y2="1870" stroke="#475569" stroke-width="2"/>

  <!-- Dashboard widgets -->
  <rect x="100" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="300" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Credit Score</text>
  <text x="300" y="1942" text-anchor="middle" font-size="15" fill="#64748b">MetricCard + Score range</text>

  <rect x="530" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="730" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Financial Age</text>
  <text x="730" y="1942" text-anchor="middle" font-size="15" fill="#64748b">Real Age + Risk Adjustment</text>

  <rect x="960" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="1160" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Risk Factors</text>
  <text x="1160" y="1942" text-anchor="middle" font-size="15" fill="#64748b">RiskBadge + Analysis</text>

  <rect x="1390" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="1590" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Debt Composition</text>
  <text x="1590" y="1942" text-anchor="middle" font-size="15" fill="#64748b">Donut Chart (Recharts)</text>

  <rect x="1820" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="2020" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Score Projection</text>
  <text x="2020" y="1942" text-anchor="middle" font-size="15" fill="#64748b">Line Chart (6 months)</text>

  <rect x="2250" y="1880" width="400" height="80" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="2450" y="1913" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">AI Recommendations</text>
  <text x="2450" y="1942" text-anchor="middle" font-size="15" fill="#64748b">POST /api/ai-recommendations</text>

  <!-- fan lines -->
  <line x1="1500" y1="1870" x2="300" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="1500" y1="1870" x2="730" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="1500" y1="1870" x2="1160" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="1500" y1="1870" x2="1590" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="1500" y1="1870" x2="2020" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="1500" y1="1870" x2="2450" y2="1880" stroke="#94a3b8" stroke-width="1.2"/>

  <text x="1500" y="2005" text-anchor="middle" font-size="22" font-weight="600" fill="#475569">Sidebar Navigation → Feature Pages</text>
  <line x1="1500" y1="2015" x2="1500" y2="2055" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- ═══════════ SECTION 4: FEATURES ═══════════ -->
  <rect x="60" y="2060" width="2880" height="700" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="2100" font-size="28" font-weight="700" fill="#334155">4. FEATURE MODULES — User Can Navigate Between These via Sidebar</text>

  <!-- Identity -->
  <rect x="80" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="80" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="300" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">/identity</text>
  <text x="100" y="2210" font-size="17" font-weight="600" fill="#374151">Identity Service (4103)</text>
  <line x1="100" y1="2225" x2="500" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="100" y="2255" font-size="16" fill="#6b7280">1. Load profile (GET)</text>
  <text x="100" y="2285" font-size="16" fill="#6b7280">2. Edit fullName, income,</text>
  <text x="100" y="2310" font-size="16" fill="#6b7280">   employment, age, bank#</text>
  <text x="100" y="2340" font-size="16" fill="#6b7280">3. Set download password</text>
  <text x="100" y="2370" font-size="16" fill="#6b7280">4. Save changes (PATCH)</text>
  <line x1="100" y1="2390" x2="500" y2="2390" stroke="#e2e8f0" stroke-width="1"/>
  <text x="100" y="2420" font-size="14" fill="#9ca3af">IdentityForm component</text>
  <text x="100" y="2450" font-size="14" fill="#9ca3af">Immutable: ID / Passport number</text>
  <text x="100" y="2480" font-size="14" fill="#9ca3af">identityUpdateSchema (Zod)</text>
  <text x="100" y="2510" font-size="14" fill="#9ca3af">DownloadOverviewButton</text>
  <line x1="100" y1="2530" x2="500" y2="2530" stroke="#e2e8f0" stroke-width="1"/>
  <text x="100" y="2560" font-size="14" font-weight="600" fill="#16a34a">DB: Users (R/W)</text>

  <!-- Debts -->
  <rect x="550" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="550" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="770" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">/debts</text>
  <text x="570" y="2210" font-size="17" font-weight="600" fill="#374151">Debts Service (4104)</text>
  <line x1="570" y1="2225" x2="970" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="570" y="2255" font-size="16" fill="#6b7280">1. List all debts (GET)</text>
  <text x="570" y="2285" font-size="16" fill="#6b7280">2. View debt table</text>
  <text x="570" y="2315" font-size="16" fill="#6b7280">3. Add new debt (POST)</text>
  <text x="570" y="2345" font-size="16" fill="#6b7280">4. Update status (PATCH)</text>
  <text x="570" y="2375" font-size="16" fill="#6b7280">5. Auto-refresh credit totals</text>
  <line x1="570" y1="2395" x2="970" y2="2395" stroke="#e2e8f0" stroke-width="1"/>
  <text x="570" y="2425" font-size="14" fill="#9ca3af">DebtsManager component</text>
  <text x="570" y="2455" font-size="14" fill="#9ca3af">No delete (financial history)</text>
  <text x="570" y="2485" font-size="14" fill="#9ca3af">GARNISHED → LegalRecord created</text>
  <text x="570" y="2515" font-size="14" fill="#9ca3af">refreshCreditProfileTotals()</text>
  <line x1="570" y1="2535" x2="970" y2="2535" stroke="#e2e8f0" stroke-width="1"/>
  <text x="570" y="2565" font-size="14" font-weight="600" fill="#db2777">DB: Debts, CreditProfile, Legal (R/W)</text>

  <!-- Income/Expense -->
  <rect x="1020" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="1020" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="1240" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">/income-expense</text>
  <text x="1040" y="2210" font-size="17" font-weight="600" fill="#374151">Cashflow Analysis (lib/)</text>
  <line x1="1040" y1="2225" x2="1440" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1040" y="2255" font-size="16" fill="#6b7280">1. Load user + debts (SSR)</text>
  <text x="1040" y="2285" font-size="16" fill="#6b7280">2. estimateLivingExpenses()</text>
  <text x="1040" y="2315" font-size="16" fill="#6b7280">3. Income input slider</text>
  <text x="1040" y="2345" font-size="16" fill="#6b7280">4. Expense breakdown</text>
  <text x="1040" y="2375" font-size="16" fill="#6b7280">5. Cashflow = Income - Exp - Debt</text>
  <line x1="1040" y1="2395" x2="1440" y2="2395" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1040" y="2425" font-size="14" fill="#9ca3af">IncomeExpensePlanner</text>
  <text x="1040" y="2455" font-size="14" fill="#9ca3af">Score pressure indicator</text>
  <text x="1040" y="2485" font-size="14" fill="#9ca3af">Expense by category</text>
  <text x="1040" y="2515" font-size="14" fill="#9ca3af">Can trigger AI recommendations</text>
  <line x1="1040" y1="2535" x2="1440" y2="2535" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1040" y="2565" font-size="14" font-weight="600" fill="#2563eb">DB: Users, Debts (Read)</text>

  <!-- Rehab -->
  <rect x="1490" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="1490" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="1710" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">/rehab</text>
  <text x="1510" y="2210" font-size="17" font-weight="600" fill="#374151">Rehab Service (4105)</text>
  <line x1="1510" y1="2225" x2="1910" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1510" y="2255" font-size="16" fill="#6b7280">1. POST plan request</text>
  <text x="1510" y="2285" font-size="16" fill="#6b7280">2. Determine strategy:</text>
  <text x="1510" y="2315" font-size="16" fill="#6b7280">   HIGH → Urgent Intervention</text>
  <text x="1510" y="2345" font-size="16" fill="#6b7280">   MED  → Stabilize &amp; Repair</text>
  <text x="1510" y="2375" font-size="16" fill="#6b7280">   LOW  → Maintenance &amp; Growth</text>
  <line x1="1510" y1="2395" x2="1910" y2="2395" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1510" y="2425" font-size="14" fill="#9ca3af">AI 4-week action plan</text>
  <text x="1510" y="2455" font-size="14" fill="#9ca3af">Top 3 actions + risk warnings</text>
  <text x="1510" y="2485" font-size="14" fill="#9ca3af">Snapshot stored in DB</text>
  <text x="1510" y="2515" font-size="14" fill="#9ca3af">OpenAI fallback: deterministic</text>
  <line x1="1510" y1="2535" x2="1910" y2="2535" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1510" y="2565" font-size="14" font-weight="600" fill="#7c3aed">DB: Users, Debts (R), AiRecs (W)</text>

  <!-- Help -->
  <rect x="1960" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="1960" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="2180" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">/help</text>
  <text x="1980" y="2210" font-size="17" font-weight="600" fill="#374151">Help Service (4106)</text>
  <line x1="1980" y1="2225" x2="2380" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1980" y="2255" font-size="16" fill="#6b7280">1. List past requests (GET)</text>
  <text x="1980" y="2285" font-size="16" fill="#6b7280">2. Select advisor type:</text>
  <text x="1980" y="2315" font-size="16" fill="#6b7280">   Financial / Debt / Legal</text>
  <text x="1980" y="2345" font-size="16" fill="#6b7280">3. Write message</text>
  <text x="1980" y="2375" font-size="16" fill="#6b7280">4. Submit request (POST)</text>
  <line x1="1980" y1="2395" x2="2380" y2="2395" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1980" y="2425" font-size="14" fill="#9ca3af">HelpRequestForm component</text>
  <text x="1980" y="2455" font-size="14" fill="#9ca3af">WhatsApp click-to-chat links</text>
  <text x="1980" y="2485" font-size="14" fill="#9ca3af">Provider lookup from DB</text>
  <text x="1980" y="2515" font-size="14" fill="#9ca3af">consultationSchema (Zod)</text>
  <line x1="1980" y1="2535" x2="2380" y2="2535" stroke="#e2e8f0" stroke-width="1"/>
  <text x="1980" y="2565" font-size="14" font-weight="600" fill="#0d9488">DB: ExpertRequests, Providers (R/W)</text>

  <!-- PDF -->
  <rect x="2430" y="2130" width="440" height="600" rx="12" fill="url(#featG)" stroke="#22c55e" stroke-width="2" filter="url(#sh)"/>
  <rect x="2430" y="2130" width="440" height="50" rx="12" fill="#bbf7d0"/>
  <text x="2650" y="2162" text-anchor="middle" font-size="22" font-weight="700" fill="#166534">PDF Export</text>
  <text x="2450" y="2210" font-size="17" font-weight="600" fill="#374151">PDF Service (4107)</text>
  <line x1="2450" y1="2225" x2="2850" y2="2225" stroke="#e2e8f0" stroke-width="1"/>
  <text x="2450" y="2255" font-size="16" fill="#6b7280">1. Click "Download Overview"</text>
  <text x="2450" y="2285" font-size="16" fill="#6b7280">2. Password gate modal</text>
  <text x="2450" y="2315" font-size="16" fill="#6b7280">3. Verify (ID or password)</text>
  <text x="2450" y="2345" font-size="16" fill="#6b7280">4. Generate PDF (pdf-lib)</text>
  <text x="2450" y="2375" font-size="16" fill="#6b7280">5. Download .pdf file</text>
  <line x1="2450" y1="2395" x2="2850" y2="2395" stroke="#e2e8f0" stroke-width="1"/>
  <text x="2450" y="2425" font-size="14" fill="#9ca3af">DownloadOverviewButton</text>
  <text x="2450" y="2455" font-size="14" fill="#9ca3af">Watermark overlay (-30 deg)</text>
  <text x="2450" y="2485" font-size="14" fill="#9ca3af">User profile + all metrics</text>
  <text x="2450" y="2515" font-size="14" fill="#9ca3af">Password hash verification</text>
  <line x1="2450" y1="2535" x2="2850" y2="2535" stroke="#e2e8f0" stroke-width="1"/>
  <text x="2450" y="2565" font-size="14" font-weight="600" fill="#ea580c">DB: Users, CreditProfile (Read)</text>

  <!-- ═══════════ SECTION 5: AI RECS ═══════════ -->
  <rect x="60" y="2790" width="2880" height="480" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="2830" font-size="28" font-weight="700" fill="#334155">5. AI RECOMMENDATIONS FLOW (Cross-cutting — used by Dashboard, Rehab, Income/Expense)</text>

  <rect x="120" y="2870" width="380" height="65" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="310" y="2900" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Triggered from:</text>
  <text x="310" y="2925" text-anchor="middle" font-size="15" fill="#64748b">Dashboard, Rehab, Income page</text>

  <line x1="500" y1="2903" x2="600" y2="2903" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>

  <rect x="600" y="2870" width="500" height="65" rx="10" fill="url(#apiG)" stroke="#7c3aed" stroke-width="2" filter="url(#sh)"/>
  <text x="850" y="2900" text-anchor="middle" font-size="19" font-weight="600" fill="#5b21b6">POST /api/ai-recommendations</text>
  <text x="850" y="2925" text-anchor="middle" font-size="15" fill="#7c3aed">lib/ai/recommendations.ts</text>

  <line x1="1100" y1="2903" x2="1200" y2="2903" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>

  <rect x="1200" y="2870" width="400" height="65" rx="10" fill="url(#actG)" stroke="#22c55e" stroke-width="1.5" filter="url(#shL)"/>
  <text x="1400" y="2900" text-anchor="middle" font-size="19" font-weight="600" fill="#166534">buildPrompt()</text>
  <text x="1400" y="2925" text-anchor="middle" font-size="15" fill="#6b7280">User profile + Debts + Context</text>

  <line x1="1600" y1="2903" x2="1700" y2="2903" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>

  <rect x="1700" y="2865" width="480" height="75" rx="10" fill="url(#extG2)" stroke="#a855f7" stroke-width="2" filter="url(#sh)"/>
  <text x="1940" y="2898" text-anchor="middle" font-size="20" font-weight="600" fill="#6b21a8">OpenAI API Call</text>
  <text x="1940" y="2928" text-anchor="middle" font-size="16" fill="#7c3aed">gpt-4.1-mini + Structured JSON Schema</text>

  <line x1="1940" y1="2940" x2="1940" y2="3010" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <!-- Decision -->
  <polygon points="1940,3010 2140,3075 1940,3140 1740,3075" fill="url(#decG)" stroke="#eab308" stroke-width="2" filter="url(#sh)"/>
  <text x="1940" y="3068" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">API</text>
  <text x="1940" y="3093" text-anchor="middle" font-size="20" font-weight="600" fill="#854d0e">Success?</text>

  <!-- Success -->
  <line x1="2140" y1="3075" x2="2420" y2="3075" stroke="#16a34a" stroke-width="2.5" marker-end="url(#aGr)"/>
  <text x="2280" y="3058" text-anchor="middle" font-size="18" fill="#16a34a">Yes</text>
  <rect x="2420" y="3045" width="380" height="65" rx="10" fill="url(#actG)" stroke="#22c55e" stroke-width="1.5" filter="url(#shL)"/>
  <text x="2610" y="3073" text-anchor="middle" font-size="19" font-weight="600" fill="#166534">Parse with Zod</text>
  <text x="2610" y="3098" text-anchor="middle" font-size="15" fill="#6b7280">aiOutputSchema validation</text>

  <!-- Failure -->
  <line x1="1740" y1="3075" x2="1460" y2="3075" stroke="#dc2626" stroke-width="2.5" marker-end="url(#aRd)"/>
  <text x="1600" y="3058" text-anchor="middle" font-size="18" fill="#dc2626">No</text>
  <rect x="1060" y="3045" width="400" height="65" rx="10" fill="url(#errG)" stroke="#ef4444" stroke-width="1.5" filter="url(#shL)"/>
  <text x="1260" y="3073" text-anchor="middle" font-size="19" font-weight="600" fill="#991b1b">fallbackRecommendations()</text>
  <text x="1260" y="3098" text-anchor="middle" font-size="15" fill="#dc2626">Deterministic by risk level</text>

  <!-- Converge → Store -->
  <line x1="1260" y1="3110" x2="1260" y2="3160" stroke="#475569" stroke-width="2"/>
  <line x1="2610" y1="3110" x2="2610" y2="3160" stroke="#475569" stroke-width="2"/>
  <line x1="1260" y1="3160" x2="2610" y2="3160" stroke="#475569" stroke-width="2"/>
  <line x1="1935" y1="3160" x2="1935" y2="3205" stroke="#475569" stroke-width="2.5" marker-end="url(#aD)"/>

  <rect x="1600" y="3210" width="670" height="50" rx="10" fill="url(#dataG)" stroke="#ec4899" stroke-width="1.5" filter="url(#shL)"/>
  <text x="1935" y="3242" text-anchor="middle" font-size="18" font-weight="600" fill="#9d174d">Store snapshot → AiRecommendations table in SQLite</text>

  <!-- ═══════════ SECTION 6: LOGOUT ═══════════ -->
  <rect x="60" y="3300" width="2880" height="170" rx="14" fill="#fff" fill-opacity="0.4" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="12,6"/>
  <text x="100" y="3340" font-size="28" font-weight="700" fill="#334155">6. SESSION TERMINATION</text>

  <rect x="600" y="3370" width="380" height="65" rx="10" fill="url(#procG)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shL)"/>
  <text x="790" y="3400" text-anchor="middle" font-size="19" font-weight="600" fill="#1e40af">Sidebar → Logout</text>
  <text x="790" y="3425" text-anchor="middle" font-size="15" fill="#64748b">Click logout button</text>

  <line x1="980" y1="3403" x2="1100" y2="3403" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>

  <rect x="1100" y="3370" width="550" height="65" rx="10" fill="url(#apiG)" stroke="#7c3aed" stroke-width="2" filter="url(#sh)"/>
  <text x="1375" y="3400" text-anchor="middle" font-size="19" font-weight="600" fill="#5b21b6">POST /api/microservices/auth/logout</text>
  <text x="1375" y="3425" text-anchor="middle" font-size="15" fill="#7c3aed">clearSessionUserId() — remove all cookies</text>

  <line x1="1650" y1="3403" x2="1770" y2="3403" stroke="#475569" stroke-width="2.5" marker-end="url(#aR)"/>

  <ellipse cx="1950" cy="3403" rx="170" ry="40" fill="url(#startG)" filter="url(#sh)"/>
  <text x="1950" y="3410" text-anchor="middle" font-size="20" font-weight="600" fill="#fff">Redirect to /login</text>

  <!-- Legend -->
  <rect x="60" y="3510" width="2880" height="120" rx="12" fill="#fff" stroke="#e2e8f0" stroke-width="1.5" filter="url(#shL)"/>
  <text x="100" y="3548" font-size="22" font-weight="700" fill="#1e293b">Legend</text>

  <ellipse cx="120" cy="3588" rx="30" ry="16" fill="url(#startG)"/>
  <text x="165" y="3595" font-size="17" fill="#374151">Start / End</text>
  <rect x="290" y="3575" width="34" height="24" rx="6" fill="url(#procG)" stroke="#3b82f6" stroke-width="1"/>
  <text x="335" y="3594" font-size="17" fill="#374151">Page / UI</text>
  <polygon points="500,3575 520,3588 500,3600 480,3588" fill="url(#decG)" stroke="#eab308" stroke-width="1"/>
  <text x="535" y="3594" font-size="17" fill="#374151">Decision</text>
  <rect x="650" y="3575" width="34" height="24" rx="6" fill="url(#actG)" stroke="#22c55e" stroke-width="1"/>
  <text x="695" y="3594" font-size="17" fill="#374151">Processing</text>
  <rect x="840" y="3575" width="34" height="24" rx="6" fill="url(#apiG)" stroke="#7c3aed" stroke-width="1"/>
  <text x="885" y="3594" font-size="17" fill="#374151">API Call</text>
  <rect x="1000" y="3575" width="34" height="24" rx="6" fill="url(#dataG)" stroke="#ec4899" stroke-width="1"/>
  <text x="1045" y="3594" font-size="17" fill="#374151">Data Store</text>
  <rect x="1180" y="3575" width="34" height="24" rx="6" fill="url(#errG)" stroke="#ef4444" stroke-width="1"/>
  <text x="1225" y="3594" font-size="17" fill="#374151">Fallback</text>
  <rect x="1350" y="3575" width="34" height="24" rx="6" fill="url(#extG2)" stroke="#a855f7" stroke-width="1"/>
  <text x="1395" y="3594" font-size="17" fill="#374151">External API</text>
  <rect x="1550" y="3575" width="34" height="24" rx="6" fill="url(#featG)" stroke="#22c55e" stroke-width="1"/>
  <text x="1595" y="3594" font-size="17" fill="#374151">Feature Module</text>
  <line x1="1770" y1="3588" x2="1830" y2="3588" stroke="#16a34a" stroke-width="2.5" marker-end="url(#aGr)"/>
  <text x="1845" y="3595" font-size="17" fill="#374151">Success</text>
  <line x1="1950" y1="3588" x2="2010" y2="3588" stroke="#dc2626" stroke-width="2.5"/>
  <text x="2025" y="3595" font-size="17" fill="#374151">Error / No</text>

  <text x="1500" y="3770" text-anchor="middle" font-size="18" fill="#94a3b8">FinAware Application Flow v1.0 — User Journey &amp; Data Flow</text>
</svg>
</div>
</body>
</html>
