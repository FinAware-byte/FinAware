{
  servers {
    protocols h1 h2 h3
  }
}

(finaware_security_headers) {
  encode zstd gzip
  header {
    Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "strict-origin-when-cross-origin"
    Permissions-Policy "accelerometer=(), autoplay=(), camera=(), geolocation=(), gyroscope=(), microphone=(), payment=(), usb=()"
    Cross-Origin-Opener-Policy "same-origin"
    Cross-Origin-Resource-Policy "same-site"
    -Server
  }
}

# Local HTTPS endpoint for local verification.
localhost {
  tls internal
  import finaware_security_headers
  reverse_proxy web:30005
}

# Public domain endpoint with Let's Encrypt certificates.
{$DOMAIN:dev.finaware.io} {
  tls {
    protocols tls1.2 tls1.3
    issuer acme {
      email {$LETSENCRYPT_EMAIL}
      ca {$LETSENCRYPT_CA:https://acme-v02.api.letsencrypt.org/directory}
    }
  }

  import finaware_security_headers
  reverse_proxy web:30005
}

www.{$DOMAIN:dev.finaware.io} {
  redir https://{$DOMAIN:dev.finaware.io}{uri} permanent
}
